;  Copyright, Wazuh Inc.
;
;  Tests for products: 
;    AWS Security Hub

[AWS Security Hub - The S3 bucket used to store CloudTrail logs is publicly accessible]
log 1 pass = {"integration": "aws", "aws": {"log_info": {"log_file": "2024/05/01/22/wazuh-security-hub-findings-1-2024-05-01-22-12-07-a765809d-87e6-4449-b81b-6f83d0c5254e", "s3bucket": "wazuh-aws-wodle-security-hub"}, "source": "securityhub", "detail_type": "Security Hub Findings - Imported", "finding": {"ProductArn": "arn:aws:securityhub:us-east-1::product/aws/securityhub", "Types": ["Software and Configuration Checks/Industry and Regulatory Standards"], "Description": "Allowing public access to CloudTrail log content might aid an adversary in identifying weaknesses in the affected account's use or configuration. To run this check, Security Hub first uses custom logic to look for the S3 bucket where your CloudTrail logs are stored.", "Compliance": {"Status": "FAILED", "SecurityControlId": "CloudTrail.6", "RelatedRequirements": ["CIS AWS Foundations Benchmark v1.2.0/2.7"], "AssociatedStandards": [{"StandardsId": "ruleset/cis-aws-foundations-benchmark/v/1.2.0"}, {"StandardsId": "standards/aws-foundational-security-best-practices/v/1.0.0"}]}, "ProductName": "Security Hub", "FirstObservedAt": "2024-01-22T09:54:13.094Z", "CreatedAt": "2024-01-22T09:54:13.094Z", "LastObservedAt": "2024-05-01T22:12:01.146Z", "CompanyName": "AWS", "FindingProviderFields": {"Types": ["Software and Configuration Checks/Industry and Regulatory Standards"], "Severity": {"Normalized": 0, "Label": "CRITICAL", "Original": "CRITICAL"}}, "ProductFields": {"RelatedAWSResources:0/name": "securityhub-cloud-trail-encryption-enabled-a262eb8e", "RelatedAWSResources:0/type": "AWS::Config::ConfigRule", "aws/securityhub/ProductName": "Security Hub", "aws/securityhub/CompanyName": "AWS", "Resources:0/Id": "arn:aws:cloudtrail:us-east-1:567970947422:trail/david-test-jan-22-2024", "aws/securityhub/FindingId": "arn:aws:securityhub:us-east-1::product/aws/securityhub/arn:aws:securityhub:us-east-1:567970947422:security-control/CloudTrail.6/finding/0df376d8-bbbd-4be4-a4b4-deb6604cb873"}, "Remediation": {"Recommendation": {"Text": "For information on how to correct this issue, consult the AWS Security Hub controls documentation.", "Url": "https://docs.aws.amazon.com/console/securityhub/CloudTrail.6/remediation"}}, "SchemaVersion": "2018-10-08", "GeneratorId": "security-control/CloudTrail.6", "RecordState": "ACTIVE", "Title": "CloudTrail should have encryption at-rest enabled", "Workflow": {"Status": "NEW"}, "Severity": {"Normalized": 0, "Label": "CRITICAL", "Original": "CRITICAL"}, "UpdatedAt": "2024-05-01T22:11:50.865Z", "WorkflowState": "NEW", "AwsAccountId": "567970947422", "Region": "us-east-1", "Id": "arn:aws:securityhub:us-east-1:567970947422:security-control/CloudTrail.6/finding/0df376d8-bbbd-4be4-a4b4-deb6604cb873", "Resources": [{"Partition": "aws", "Type": "AwsCloudTrailTrail", "Region": "us-east-1", "Id": "arn:aws:cloudtrail:us-east-1:567970947422:trail/david-test-jan-22-2024"}], "ProcessedAt": "2024-05-01T22:12:05.695Z"}}}
rule = 99836
alert = 12
decoder = json

[AWS Security Hub - Hardware MFA not enabled for the root user]
log 1 pass = {"integration": "aws", "aws": {"log_info": {"log_file": "2024/05/01/22/wazuh-security-hub-findings-1-2024-05-01-22-12-07-a765809d-87e6-4449-b81b-6f83d0c5254e", "s3bucket": "wazuh-aws-wodle-security-hub"}, "source": "securityhub", "detail_type": "Security Hub Findings - Imported", "finding": {"ProductArn": "arn:aws:securityhub:us-east-1::product/aws/securityhub", "Types": ["Software and Configuration Checks/Industry and Regulatory Standards"], "Description": "This AWS control checks whether your AWS account is enabled to use a hardware multi-factor authentication (MFA) device to sign in with root user credentials.", "Compliance": {"Status": "FAILED", "SecurityControlId": "IAM.6", "RelatedRequirements": ["CIS AWS Foundations Benchmark v1.2.0/1.14"], "AssociatedStandards": [{"StandardsId": "ruleset/cis-aws-foundations-benchmark/v/1.2.0"}, {"StandardsId": "standards/aws-foundational-security-best-practices/v/1.0.0"}]}, "ProductName": "Security Hub", "FirstObservedAt": "2024-01-05T09:26:17.001Z", "CreatedAt": "2024-01-05T09:26:17.001Z", "LastObservedAt": "2024-05-01T22:12:20.039Z", "CompanyName": "AWS", "FindingProviderFields": {"Types": ["Software and Configuration Checks/Industry and Regulatory Standards"], "Severity": {"Normalized": 90, "Label": "CRITICAL", "Original": "CRITICAL"}}, "ProductFields": {"RelatedAWSResources:0/name": "securityhub-root-account-hardware-mfa-enabled-664bd5dd", "RelatedAWSResources:0/type": "AWS::Config::ConfigRule", "aws/securityhub/ProductName": "Security Hub", "aws/securityhub/CompanyName": "AWS", "Resources:0/Id": "arn:aws:iam::567970947422:root", "aws/securityhub/FindingId": "arn:aws:securityhub:us-east-1::product/aws/securityhub/arn:aws:securityhub:us-east-1:567970947422:security-control/IAM.6/finding/4ff4e71a-5eab-4c6f-922d-06229726b924"}, "Remediation": {"Recommendation": {"Text": "For information on how to correct this issue, consult the AWS Security Hub controls documentation.", "Url": "https://docs.aws.amazon.com/console/securityhub/IAM.6/remediation"}}, "SchemaVersion": "2018-10-08", "GeneratorId": "security-control/IAM.6", "RecordState": "ACTIVE", "Title": "Hardware MFA should be enabled for the root user", "Workflow": {"Status": "NEW"}, "Severity": {"Normalized": 90, "Label": "CRITICAL", "Original": "CRITICAL"}, "UpdatedAt": "2024-05-01T22:12:09.158Z", "WorkflowState": "NEW", "AwsAccountId": "567970947422", "Region": "us-east-1", "Id": "arn:aws:securityhub:us-east-1:567970947422:security-control/IAM.6/finding/4ff4e71a-5eab-4c6f-922d-06229726b924", "Resources": [{"Partition": "aws", "Type": "AwsAccount", "Region": "us-east-1", "Id": "AWS::::Account:567970947422"}], "ProcessedAt": "2024-05-01T22:12:24.049Z"}}}
rule = 99846
alert = 12
decoder = json

[AWS Security Hub - IAM root user access key exist]
log 1 pass = {"integration": "aws", "aws": {"log_info": {"log_file": "2024/05/01/22/wazuh-security-hub-findings-1-2024-05-01-22-12-07-a765809d-87e6-4449-b81b-6f83d0c5254e", "s3bucket": "wazuh-aws-wodle-security-hub"}, "source": "securityhub", "detail_type": "Security Hub Findings - Imported", "finding": {"ProductArn": "arn:aws:securityhub:us-east-1::product/aws/securityhub", "Types": ["Software and Configuration Checks/Industry and Regulatory Standards"], "Description": "This control checks whether the root user access key is present.", "Compliance": {"Status": "FAILED", "SecurityControlId": "IAM.4", "RelatedRequirements": ["CIS AWS Foundations Benchmark v1.2.0/1.14"], "AssociatedStandards": [{"StandardsId": "ruleset/cis-aws-foundations-benchmark/v/1.2.0"}, {"StandardsId": "standards/aws-foundational-security-best-practices/v/1.0.0"}]}, "ProductName": "Security Hub", "FirstObservedAt": "2024-01-05T09:26:17.001Z", "CreatedAt": "2024-01-05T09:26:17.001Z", "LastObservedAt": "2024-05-01T22:12:20.039Z", "CompanyName": "AWS", "FindingProviderFields": {"Types": ["Software and Configuration Checks/Industry and Regulatory Standards"], "Severity": {"Normalized": 90, "Label": "CRITICAL", "Original": "CRITICAL"}}, "ProductFields": {"RelatedAWSResources:0/name": "securityhub-root-account-hardware-mfa-enabled-664bd5dd", "RelatedAWSResources:0/type": "AWS::Config::ConfigRule", "aws/securityhub/ProductName": "Security Hub", "aws/securityhub/CompanyName": "AWS", "Resources:0/Id": "arn:aws:iam::567970947422:root", "aws/securityhub/FindingId": "arn:aws:securityhub:us-east-1::product/aws/securityhub/arn:aws:securityhub:us-east-1:567970947422:security-control/IAM.4/finding/4ff4e71a-5eab-4c6f-922d-06229726b924"}, "Remediation": {"Recommendation": {"Text": "For information on how to correct this issue, consult the AWS Security Hub controls documentation.", "Url": "https://docs.aws.amazon.com/console/securityhub/IAM.4/remediation"}}, "SchemaVersion": "2018-10-08", "GeneratorId": "security-control/IAM.4", "RecordState": "ACTIVE", "Title": "Hardware MFA should be enabled for the root user", "Workflow": {"Status": "NEW"}, "Severity": {"Normalized": 90, "Label": "CRITICAL", "Original": "CRITICAL"}, "UpdatedAt": "2024-05-01T22:12:09.158Z", "WorkflowState": "NEW", "AwsAccountId": "567970947422", "Region": "us-east-1", "Id": "arn:aws:securityhub:us-east-1:567970947422:security-control/IAM.4/finding/4ff4e71a-5eab-4c6f-922d-06229726b924", "Resources": [{"Partition": "aws", "Type": "AwsAccount", "Region": "us-east-1", "Id": "AWS::::Account:567970947422"}], "ProcessedAt": "2024-05-01T22:12:24.049Z"}}}
rule = 99845
alert = 12
decoder = json

[AWS Security Hub - MFA not enabled for the root user]
log 1 pass = {"integration": "aws", "aws": {"log_info": {"log_file": "2024/05/01/22/wazuh-security-hub-findings-1-2024-05-01-22-12-07-a765809d-87e6-4449-b81b-6f83d0c5254e", "s3bucket": "wazuh-aws-wodle-security-hub"}, "source": "securityhub", "detail_type": "Security Hub Findings - Imported", "finding": {"ProductArn": "arn:aws:securityhub:us-east-1::product/aws/securityhub", "Types": ["Software and Configuration Checks/Industry and Regulatory Standards"], "Description": "This AWS control checks whether users of your AWS account require a multi-factor authentication (MFA) device to sign in with root user credentials.", "Compliance": {"Status": "FAILED", "SecurityControlId": "IAM.9", "RelatedRequirements": ["CIS AWS Foundations Benchmark v1.2.0/1.13"], "AssociatedStandards": [{"StandardsId": "ruleset/cis-aws-foundations-benchmark/v/1.2.0"}]}, "ProductName": "Security Hub", "FirstObservedAt": "2024-01-05T09:26:08.142Z", "CreatedAt": "2024-01-05T09:26:08.142Z", "LastObservedAt": "2024-05-01T22:12:22.691Z", "CompanyName": "AWS", "FindingProviderFields": {"Types": ["Software and Configuration Checks/Industry and Regulatory Standards"], "Severity": {"Normalized": 90, "Label": "CRITICAL", "Original": "CRITICAL"}}, "ProductFields": {"RelatedAWSResources:0/name": "securityhub-root-account-mfa-enabled-d58a4c25", "RelatedAWSResources:0/type": "AWS::Config::ConfigRule", "aws/securityhub/ProductName": "Security Hub", "aws/securityhub/CompanyName": "AWS", "Resources:0/Id": "arn:aws:iam::567970947422:root", "aws/securityhub/FindingId": "arn:aws:securityhub:us-east-1::product/aws/securityhub/arn:aws:securityhub:us-east-1:567970947422:security-control/IAM.9/finding/bdbe68ab-72d0-41cb-9818-9386977639ef"}, "Remediation": {"Recommendation": {"Text": "For information on how to correct this issue, consult the AWS Security Hub controls documentation.", "Url": "https://docs.aws.amazon.com/console/securityhub/IAM.9/remediation"}}, "SchemaVersion": "2018-10-08", "GeneratorId": "security-control/IAM.9", "RecordState": "ACTIVE", "Title": "MFA should be enabled for the root user", "Workflow": {"Status": "NEW"}, "Severity": {"Normalized": 90, "Label": "CRITICAL", "Original": "CRITICAL"}, "UpdatedAt": "2024-05-01T22:12:10.223Z", "WorkflowState": "NEW", "AwsAccountId": "567970947422", "Region": "us-east-1", "Id": "arn:aws:securityhub:us-east-1:567970947422:security-control/IAM.9/finding/bdbe68ab-72d0-41cb-9818-9386977639ef", "Resources": [{"Partition": "aws", "Type": "AwsAccount", "Region": "us-east-1", "Id": "AWS::::Account:567970947422"}], "ProcessedAt": "2024-05-01T22:12:27.576Z"}}}
rule = 99847
alert = 12
decoder = json

